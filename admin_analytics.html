<!DOCTYPE html>
<html lang="en">
<title>Admin Dashboard</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">




<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.css">

<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"></script>

<style>
html,body,h1,h2,h3,h4,h5,h6 {font-family: "Roboto", sans-serif;}

</style>
<body onload="populates_filters()">

  <div class="w3-top w3-hide-large">
    <div class="w3-bar w3-black w3-card">
      <a class="w3-bar-item w3-button w3-padding-large w3-hide-large w3-right" href="javascript:void(0)" onclick="myFunction()" title="Toggle Navigation Menu"><i class="fa fa-bars"></i></a>
      <a href="./admin_hotels.html" class="w3-bar-item w3-button w3-padding-large">Hotels</a>
        </div>
      </div>
    </div>
  </div>

  <div id="navDemo" class="w3-bar-block w3-black w3-hide w3-hide-large w3-hide-medium w3-top" style="margin-top:46px">
    <a href="./admin_staff.html" class="w3-bar-item w3-button w3-padding-large" >Staff</a>
    <a href="./admin_analytics.html" class="w3-bar-item w3-button w3-padding-large" >Analytics</a>
    <a href="./admin_create_reservation.html" class="w3-bar-item w3-button w3-padding-large" >Create Reservation</a>
    <a href="./admin_modify_reservation.html" class="w3-bar-item w3-button w3-padding-large" >Modify Reservation</a>
    <a href="./admin_checkin.html" class="w3-bar-item w3-button w3-padding-large" >Check-in</a>
    <a href="./admin_login.html" class="w3-bar-item w3-button w3-padding-large" onclick="logout()">Logout</a>

  </div>
<!-- Sidebar -->
<div class="w3-row">

<div class="w3-onethird w3-sidebar w3-bar-block w3-collapse w3-large w3-theme-l5" id="mySidebar">
  <br>
  <center><h4 ><b>Admin Menu</b></h4></center>
  <br>
  <center><h4 id="admin_name"><b>Welcome AdminName!</b></h4></center>
  <br>
  <a class="w3-bar-item w3-button w3-hover-black" href="./admin_hotels.html">Hotels</a>
  <a class="w3-bar-item w3-button w3-hover-black" href="./admin_staff.html">Staff</a>
  <a class="w3-bar-item w3-button w3-hover-black" href="./admin_analytics.html">Analytics</a>
  <a class="w3-bar-item w3-button w3-hover-black" href="./admin_create_reservation.html">Create Reservation</a>
  <a class="w3-bar-item w3-button w3-hover-black" href="./admin_modify_reservation.html">Modify Reservation</a>
  <a class="w3-bar-item w3-button w3-hover-black" href="./admin_checkin.html">Check-in</a>
  <a class="w3-bar-item w3-button w3-hover-black" href="./admin_login.html" onclick="logout()">Logout</a>

</div>

<!-- Overlay effect when opening sidebar on small screens -->
<!-- Main content: shift it to the right by 250 pixels when the sidebar is visible -->

<div class="w3-main" style="margin-left:250px;margin-right:10px;">
  <span class="w3-hide-large">
    <br><br><center><h2><i class="fa fa-dashboard"></i> Analytics:</h2></center>
  </span>

  <span class="w3-hide-medium w3-hide-small">
    <h2><i class="fa fa-dashboard"></i> Analytics:</h2>
  </span>

  <center><select name="time_period" id="time_period" class="w3-xlarge">
      <option value="Today">Today</option>
      <option value="Yesterday">Yesterday</option>
      <option value="Past 7 Days">Past 7 Days</option>
      <option value="Past 30 Days">Past 30 Days</option>
      <option value="Past 365 Days">Past 365 Days</option>
      <option value="All Time">All Time</option>

  </select>
  <select  name="hotel_options" id="hotel_options" class="w3-xlarge">
  </select></center>
  <br>
  <br>
  <center><a style="margin-left:20px;" class="w3-button w3-black w3-large" onclick="populate_table()">View Analytics</a></center>

  <br>
  <br>

<div>
  <div>

    <!-- Header -->


    <div class="w3-row-padding w3-margin-bottom">
      <div class="w3-third">
        <div class="w3-container w3-teal w3-padding-16">
          <div class="w3-left"><i class='fa fa-money	w3-xxxlarge'></i></div>
          <div class="w3-right">
            <h3 id="revenue">0</h3>
          </div>
          <div class="w3-clear"></div>
          <h4>Total Revenue</h4>
        </div>
      </div>
      <div class="w3-third">
        <div class="w3-container w3-teal w3-padding-16">
          <div class="w3-left"><i class="fa fa-calendar w3-xxxlarge"></i></div>
          <div class="w3-right">
            <h3 id="bookings">0</h3>
          </div>
          <div class="w3-clear"></div>
          <h4>Total Bookings</h4>
        </div>
      </div>
      <div class="w3-third">
        <div class="w3-container w3-teal w3-padding-16">
          <div class="w3-left"><i class="	fa fa-building w3-xxxlarge"></i></div>
          <div class="w3-right">
            <h3 id="popular_room">None</h3>
          </div>
          <div class="w3-clear"></div>
          <h4>Most Popular Hotel Room</h4>
        </div>
      </div>
    </div>

    <br>
    <br>
    <br>

    <div class="w3-container">
      <table class="display" id="reservation_table">
        <thead>
          <tr>
            <th>Hotel</th>
            <th>Reservation Id</th>
            <th>Room Type</th>
            <th>Price</th>
            <th>Number of Adults</th>
            <th>Number of Children</th>
            <th>Start Date</th>
            <th>End Date</th>
          </tr>
        </thead>
        <tbody>
          <tr>
              <td>Row 1 Data 1</td>
              <td>Row 1 Data 2</td>
              <td>Row 1 Data 1</td>
              <td>Row 1 Data 2</td>
              <td>Row 1 Data 1</td>
              <td>Row 1 Data 2</td>
              <td>Row 1 Data 1</td>
              <td>Row 1 Data 2</td>
          </tr>

        </tbody>



      </table>

    </div>
</div>




<!-- END MAIN -->
</div>
</div>

<script>


function myFunction() {
  var x = document.getElementById("navDemo");
  if (x.className.indexOf("w3-show") == -1) {
    x.className += " w3-show";
  } else {
    x.className = x.className.replace(" w3-show", "");
  }
}
function logout()
{
  localStorage.removeItem("UID");

  window.open("./admin_login.html","_self");

}

function get_admin()
{

  var UID = localStorage.getItem("UID");

  const Http = new XMLHttpRequest();
  const url='http://ec2-18-188-237-63.us-east-2.compute.amazonaws.com:5000/admin_verify?UID='+UID;
  Http.open("GET", url);
  Http.send();


  Http.onreadystatechange = (e) => {
    var response = JSON.parse(Http.responseText);
    if (response[0].CODE == 0)
    {
      var name = response[0].NAME;
      document.getElementById("admin_name").innerHTML = '<b>Welcome '+name+'!</b>';

    }else
    {
      window.open("./admin_login.html","_self");
    }
  }




}

function add_staff()
{

  var first_name = document.getElementById('first_name').value;
  var last_name = document.getElementById('last_name').value;
  var phone_number = document.getElementById('phone_number').value;
  var member_email = document.getElementById('member_email').value;
  var salary = document.getElementById('salary').value;
  var password = document.getElementById('password').value;


  const Http = new XMLHttpRequest();
  const url='http://ec2-18-188-237-63.us-east-2.compute.amazonaws.com:5000/add_staff_member?&first_name='+first_name+'&last_name='+last_name+'&phone_number='+phone_number+'&member_email='+member_email+'&salary='+salary+'&password='+password;
  Http.open("GET", url);
  Http.send();


  Http.onreadystatechange = (e) => {
    if (parseInt(Http.responseText) == 0)
    {
      alert("Staff Member Successfully Added!");
      location.reload();

    }
  }


}


function populates_filters()
{
  get_admin();

  $(document).ready( function () {
      $('#reservation_table').DataTable();
  } );


  var table = $('#reservation_table').DataTable();

  table.clear().draw();

  const Http = new XMLHttpRequest();
  const url='http://ec2-18-188-237-63.us-east-2.compute.amazonaws.com:5000/admin_hotels';
  Http.open("GET", url);
  Http.send();


  Http.onreadystatechange = (e) => {
    document.getElementById('hotel_options').innerHTML = '';
    var hotels = JSON.parse(Http.responseText);
    var hotelsLen = Object.keys(hotels).length;

    for(var i = 0; i < hotelsLen; i++)
    {
      var hotel = hotels[i];


      var option = document.createElement('option');
      option.value = hotel.HID;
      option.id = hotel.HID;
      option.innerHTML = hotel.Name;
      document.getElementById('hotel_options').appendChild(option);

    }
    var option = document.createElement('option');
    option.value = "All Hotels";
    option.id = "All Hotels";
    option.innerHTML = "All Hotels";
    document.getElementById('hotel_options').appendChild(option);


  }
}




function populate_table()
{



  var time_period = document.getElementById('time_period').value;
  var hotel_id = document.getElementById('hotel_options').value;
  document.getElementById('revenue').innerHTML = 0;
  document.getElementById('bookings').innerHTML = 0;
  document.getElementById('popular_room').innerHTML = "None";

  const Http = new XMLHttpRequest();
  const url='http://ec2-18-188-237-63.us-east-2.compute.amazonaws.com:5000/get_reservations_analytics?time_period='+time_period+'&hotel_id='+hotel_id;
  Http.open("GET", url);
  Http.send();


  Http.onreadystatechange = (e) => {
    var reservations = JSON.parse(Http.responseText);
    var reservation_length = Object.keys(reservations).length;


    var table = $('#reservation_table').DataTable();

    table.clear().draw();

    var table = $('#reservation_table').DataTable();


          for(var i = 0 ; i < reservation_length-1; i++)
          {
            table.row.add([reservations[i].HID,reservations[i].RID,reservations[i].ROOM_TYPE,reservations[i].PRICE,reservations[i].NUM_ADULTS,reservations[i].NUM_CHILDREN,reservations[i].START_DATE,reservations[i].END_DATE]).draw();
          }


          document.getElementById('revenue').innerHTML = "$"+reservations[reservation_length-1].Revenue.toFixed(2);
          document.getElementById('bookings').innerHTML = reservations[reservation_length-1].Bookings;
          document.getElementById('popular_room').innerHTML = reservations[reservation_length-1].Popular_Room;


  }


}






</script>

</body>
</html>
